<!DOCTYPE html>
<html lang="id" data-theme="light">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Dashboard Absen - User</title>
	<link rel="icon" type="image/svg+xml" href="/src/assets/sinyal.svg">
	<link rel="shortcut icon" type="image/svg+xml" href="/src/assets/sinyal.svg">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://absenpanha.com/src/assets/css/home-user-dashboard.css?v=3e8b163857180e76ecd122e527dc9065">
	<script>
		(function () {
			var themeValue = "";
			try {
				themeValue = String(window.localStorage.getItem("home_index_theme") || "").toLowerCase();
			} catch (error) {}
			if (themeValue !== "dark" && themeValue !== "light") {
				var cookieMatch = document.cookie.match(/(?:^|;\s*)home_index_theme=(dark|light)\b/i);
				if (cookieMatch && cookieMatch[1]) {
					themeValue = String(cookieMatch[1]).toLowerCase();
				}
			}
			if (themeValue === "dark" || themeValue === "light") {
				try {
					window.localStorage.setItem("home_index_theme", themeValue);
				} catch (error) {}
				try {
					document.cookie = "home_index_theme=" + encodeURIComponent(themeValue) + ";path=/;max-age=31536000;SameSite=Lax";
				} catch (error) {}
			}
			if (themeValue === "dark") {
				document.documentElement.classList.add("theme-dark");
				document.documentElement.setAttribute("data-theme", "dark");
			} else if (themeValue === "light") {
				document.documentElement.classList.remove("theme-dark");
				document.documentElement.setAttribute("data-theme", "light");
			}
		})();
	</script>
	<script src="https://absenpanha.com/src/assets/js/theme-global-init.js?v=1772074009"></script>
		<link rel="stylesheet" href="https://absenpanha.com/src/assets/css/theme-global.css?v=1772073992">
</head>
<body data-theme-mobile-toggle="1" data-theme-native-toggle="1">
	<nav class="topbar">
		<div class="topbar-container">
			<div class="topbar-inner">
				<a href="https://absenpanha.com/home" class="brand">
					<img class="brand-logo" src="https://absenpanha.com/src/assets/pns_logo_nav.png?v=b1f946dbe7be0c81b013a0dd917f9d14" alt="Logo Absen Online">
					<span class="brand-text">Dashboard User Absen</span>
				</a>
				<div class="topbar-actions">
					<button type="button" class="theme-navbar-toggle" id="themeToggleButton" aria-label="Aktifkan mode malam" aria-pressed="false" title="Ganti ke mode malam">
						<span class="theme-navbar-toggle-track" aria-hidden="true">
							<span class="theme-navbar-toggle-icon sun">&#9728;</span>
							<span class="theme-navbar-toggle-icon moon">&#9790;</span>
							<span class="theme-navbar-toggle-knob"></span>
						</span>
					</button>
					<a href="https://absenpanha.com/logout" class="logout">Logout</a>
				</div>
			</div>
		</div>
	</nav>

	<main class="container">
		<section class="hero">
			<p class="pill" id="summaryStatusPill">Sudah Check In</p>
			<div class="hero-greeting">
				<img class="hero-avatar" src="https://absenpanha.com/uploads/profile_photo/pp_ridwan_20260222142441_9cfe1d4749_thumb.jpg?v=1771745081" alt="PP Muhammad Ridwan K.">
				<h1 class="hero-title">Halo, Muhammad Ridwan K.. Siap absen hari ini?</h1>
			</div>
			<p class="hero-subtitle">Setiap absen wajib kamera dan GPS aktif. Ambil foto langsung dari popup absensi sebelum menyimpan.</p>
			<p class="hero-note">Absen masuk dibuka mulai 07:30 WIB. Jam masuk resmi 08:00 WIB (tidak telat sampai 08:00).</p>
			<p class="shift-badge">Jabatan: Magang</p>
			<p class="shift-badge">Shift Pagi - Sore | 08:00 - 17:00</p>

			<div class="action-wrap">
				<div class="action-column">
					<button type="button" class="action-btn checkin" data-attendance-open="true">
						<p class="action-title">Absen</p>
						<p class="action-text">Tap untuk pilih absen masuk atau pulang.</p>
					</button>
					<button type="button" class="action-btn leave is-coming-soon" disabled aria-disabled="true" title="COMING SOON">
						<span class="coming-soon-badge">COMING SOON</span>
						<p class="action-title">Pengajuan Cuti</p>
						<p class="action-text">Ajukan cuti jika kamu akan libur kerja.</p>
					</button>
				</div>
				<div class="action-column">
					<button type="button" class="action-btn permit" data-request-type="izin">
						<p class="action-title">Pengajuan Izin</p>
						<p class="action-text">Ajukan izin untuk keperluan tertentu.</p>
					</button>
					<button type="button" class="action-btn loan" data-loan-open="true">
						<p class="action-title">Pengajuan Pinjaman</p>
						<p class="action-text">Ajukan pinjaman dengan nominal, tenor, alasan, dan rincian otomatis.</p>
					</button>
					<button type="button" class="action-btn swap" data-swap-open="true">
						<p class="action-title">Pengajuan Tukar Libur</p>
						<p class="action-text">Ajukan tukar hari libur 1x. Wajib menunggu persetujuan admin.</p>
					</button>
				</div>
			</div>

			<div class="meta">
				<div class="meta-box">
					<p class="meta-label">Jam Masuk / Pulang</p>
					<p class="meta-value">
						<span id="summaryJamMasuk">08:00</span>
						/
						<span id="summaryJamPulang">-</span>
					</p>
				</div>
				<div class="meta-box warning">
					<p class="meta-label">Target Jam Pulang</p>
					<p class="meta-value"><span id="summaryTargetPulang">17:00</span> WIB</p>
				</div>
			</div>

			<div class="summary-grid">
				<div class="summary-item">
					<p class="summary-label">Hadir Bulan Ini</p>
					<p class="summary-value"><span id="summaryHadirBulan">4</span> Hari</p>
				</div>
				<div class="summary-item">
					<p class="summary-label">Terlambat</p>
					<p class="summary-value"><span id="summaryTerlambatBulan">2</span> Hari</p>
				</div>
				<div class="summary-item">
					<p class="summary-label">Izin/Cuti</p>
					<p class="summary-value"><span id="summaryIzinBulan">0</span> Hari</p>
				</div>
			</div>
		</section>

		<section class="history" id="ubah-password">
			<h2 class="history-title">Ganti Password Akun</h2>
									<form class="password-form" method="post" action="https://absenpanha.com/home/update_my_password" autocomplete="off">
				<div class="password-grid">
					<div class="password-field">
						<label class="password-label" for="currentPassword">Password Saat Ini</label>
						<input class="password-input" type="password" id="currentPassword" name="current_password" required>
					</div>
					<div class="password-field">
						<label class="password-label" for="newPassword">Password Baru</label>
						<input class="password-input" type="password" id="newPassword" name="new_password" minlength="3" required>
					</div>
					<div class="password-field">
						<label class="password-label" for="confirmPassword">Konfirmasi Password Baru</label>
						<input class="password-input" type="password" id="confirmPassword" name="confirm_password" minlength="3" required>
					</div>
				</div>
				<button type="submit" class="password-submit">Simpan Password Baru</button>
			</form>
		</section>

		<section class="history">
			<h2 class="history-title">Riwayat Absensi Terbaru</h2>
			<div class="table-wrap">
				<table>
					<thead>
						<tr>
							<th>Tanggal</th>
							<th>Masuk</th>
							<th>Pulang</th>
							<th>Status</th>
							<th>Catatan</th>
							<th>Potongan</th>
						</tr>
					</thead>
					<tbody id="historyTableBody">
																													<tr>
									<td>Kamis, 26 Februari 2026</td>
									<td>08:00</td>
									<td>-</td>
									<td><span class="badge hadir">Hadir</span></td>
									<td>On time</td>
									<td>-</td>
								</tr>
																							<tr>
									<td>Rabu, 25 Februari 2026</td>
									<td>07:53</td>
									<td>18:55</td>
									<td><span class="badge hadir">Hadir</span></td>
									<td>Selesai check out</td>
									<td>-</td>
								</tr>
																							<tr>
									<td>Selasa, 24 Februari 2026</td>
									<td>08:01</td>
									<td>-</td>
									<td><span class="badge terlambat">Terlambat</span></td>
									<td>Terlambat 00:01:09</td>
									<td>-</td>
								</tr>
																							<tr>
									<td>Senin, 23 Februari 2026</td>
									<td>08:09</td>
									<td>17:06</td>
									<td><span class="badge terlambat">Terlambat</span></td>
									<td>Terlambat 00:09:43</td>
									<td>Rp 9.000</td>
								</tr>
																		</tbody>
				</table>
			</div>
		</section>

		<section class="history">
			<h2 class="history-title">Riwayat Pinjaman</h2>
			<div class="table-wrap">
				<table>
					<thead>
						<tr>
							<th>Tanggal</th>
							<th>Nominal</th>
							<th>Tenor</th>
							<th>Cicilan/Bulan</th>
							<th>Status</th>
						</tr>
					</thead>
					<tbody id="loanHistoryTableBody">
													<tr>
								<td colspan="5">Belum ada riwayat pinjaman.</td>
							</tr>
											</tbody>
				</table>
			</div>
		</section>
	</main>

	<div id="attendanceModal" class="attendance-modal" aria-hidden="true">
		<div class="modal-overlay" data-modal-close></div>
		<section class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="attendanceTitle">
			<div class="modal-head">
				<h2 id="attendanceTitle" class="modal-title">Proses Absensi</h2>
				<button type="button" class="modal-close" id="closeAttendanceModal" aria-label="Tutup popup">&times;</button>
			</div>
			<div class="modal-body">
				<div class="modal-grid">
					<div class="preview-card">
						<p class="card-label">Preview Kamera</p>
						<div class="video-wrap">
							<video id="cameraPreview" class="camera-video" autoplay muted playsinline></video>
							<div id="cameraPlaceholder" class="camera-placeholder">Meminta akses kamera...</div>
						</div>
						<div class="control-row">
							<select id="cameraSelect" class="camera-select" aria-label="Pilih kamera">
								<option value="">Memuat daftar kamera...</option>
							</select>
							<button type="button" id="capturePhotoButton" class="capture-btn" disabled>Ambil Foto</button>
						</div>
						<canvas id="captureCanvas" width="1280" height="720" hidden></canvas>
					</div>
					<div class="info-card">
						<p class="card-label">Informasi Absensi</p>
						<div class="info-item">
							<p class="info-title">Jenis Absensi (Wajib Pilih)</p>
							<select id="attendanceTypeSelect" class="request-input" aria-label="Pilih jenis absensi">
								<option value="masuk">Absen Masuk</option>
								<option value="pulang">Absen Pulang</option>
							</select>
						</div>
							<div class="info-item">
								<p class="info-title">Shift</p>
								<p id="shiftValue" class="info-value">Shift Pagi - Sore (08:00 - 17:00)</p>
																	<ul class="shift-detail-list">
																					<li>Tidak telat jika absen masuk pukul 07:30 - 08:00 WIB.</li>
																					<li>Mulai telat pada pukul 08:01 - 17:00 WIB.</li>
																					<li>Agar tidak telat: lakukan absen sebelum 08:01 WIB.</li>
																			</ul>
															</div>
							<div class="info-item">
								<p class="info-title">Aturan Waktu</p>
								<p class="info-value">Masuk: dibuka 07:30 WIB | Jam masuk resmi 08:00 WIB | Pulang: maksimal 23:00 WIB (wajib sudah absen masuk)</p>
							</div>
							<div class="info-item">
								<p class="info-title">GPS</p>
								<p id="gpsValue" class="info-value">Meminta lokasi...</p>
							</div>
						<div class="info-item">
							<p class="info-title">Waktu</p>
							<p id="timeValue" class="info-value">-</p>
						</div>
						<div class="info-item late-reason-wrap" id="lateReasonWrap">
							<p class="info-title">Alasan Telat (Wajib Jika Telat)</p>
							<textarea id="lateReasonInput" class="late-reason-input" placeholder="Tulis alasan keterlambatan saat absen masuk..."></textarea>
						</div>
					</div>
				</div>

				<div id="captureResult" class="capture-result">
					<h3>Hasil Foto Absensi</h3>
					<img id="capturedImage" class="capture-image" src="" alt="Hasil foto absensi">
					<p id="resultMeta" class="result-meta"></p>
				</div>
			</div>
		</section>
	</div>

	<div id="requestModal" class="request-modal" aria-hidden="true">
		<div class="modal-overlay" data-request-close></div>
		<section class="request-panel" role="dialog" aria-modal="true" aria-labelledby="requestTitle">
			<div class="request-head">
				<h2 id="requestTitle" class="request-title">Form Pengajuan</h2>
				<button type="button" class="modal-close" id="closeRequestModal" aria-label="Tutup popup pengajuan">&times;</button>
			</div>
			<div class="request-body">
				<form id="leaveRequestForm" class="request-form" novalidate>
					<input type="hidden" id="requestTypeInput" name="request_type" value="">
					<p class="request-kind">Jenis pengajuan: <strong id="requestTypeLabel">-</strong></p>
					<div class="request-field is-hidden" id="izinTypeWrap">
						<label for="izinTypeInput" class="request-label">Jenis Izin</label>
						<select id="izinTypeInput" class="request-input" name="izin_type">
							<option value="sakit">Sakit</option>
							<option value="darurat">Izin Darurat</option>
						</select>
					</div>
					<div class="request-grid">
						<div class="request-field">
							<label for="requestStartDate" class="request-label">Tanggal Mulai</label>
							<input id="requestStartDate" class="request-input" type="date" name="start_date" required>
						</div>
						<div class="request-field">
							<label for="requestEndDate" class="request-label">Tanggal Selesai</label>
							<input id="requestEndDate" class="request-input" type="date" name="end_date" required>
						</div>
					</div>
					<div class="request-field">
						<label for="requestReason" class="request-label" id="requestReasonLabel">Alasan Izin</label>
						<textarea id="requestReason" class="request-textarea" name="reason" placeholder="Contoh: ada keperluan keluarga / urusan administrasi penting..." required></textarea>
					</div>
					<div class="request-field">
						<label for="requestSupportFile" class="request-label" id="requestSupportLabel">Bukti (Opsional)</label>
						<input id="requestSupportFile" class="request-input" type="file" name="support_file" accept=".pdf,.png,.jpg,.heic">
						<p class="request-hint" id="requestSupportHint">Format yang diizinkan: .pdf, .png, .jpg, .heic</p>
					</div>
					<button type="submit" id="submitLeaveRequestButton" class="request-submit">Kirim Pengajuan</button>
				</form>
			</div>
		</section>
	</div>

	<div id="loanModal" class="request-modal" aria-hidden="true">
		<div class="modal-overlay" data-loan-close></div>
		<section class="request-panel" role="dialog" aria-modal="true" aria-labelledby="loanTitle">
			<div class="request-head">
				<h2 id="loanTitle" class="request-title">Form Pengajuan Pinjaman</h2>
				<button type="button" class="modal-close" id="closeLoanModal" aria-label="Tutup popup pinjaman">&times;</button>
			</div>
			<div class="request-body">
				<form id="loanRequestForm" class="request-form" novalidate>
					<div class="request-field">
						<div class="request-label-row">
							<label for="loanAmount" class="request-label">Nominal Pinjaman</label>
							<p class="request-label-note">Min Rp 500.000 | Max Rp 10.000.000</p>
						</div>
						<input id="loanAmount" class="request-input" type="text" inputmode="numeric" autocomplete="off" placeholder="Contoh: 1500000" required>
					</div>
					<div class="request-field">
						<label for="loanTenor" class="request-label">Tenor (Bulan)</label>
						<input id="loanTenor" type="hidden" value="">
						<div class="tenor-picker" id="loanTenorPicker">
							<div class="tenor-grid">
																	<button type="button" class="tenor-btn" data-loan-tenor="1" aria-pressed="false">1 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="2" aria-pressed="false">2 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="3" aria-pressed="false">3 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="4" aria-pressed="false">4 bulan</button>
															</div>
							<button type="button" id="toggleMoreTenorButton" class="tenor-more-toggle">Lihat lainnya...</button>
							<div id="tenorMoreWrap" class="tenor-grid is-hidden">
																	<button type="button" class="tenor-btn" data-loan-tenor="5" aria-pressed="false">5 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="6" aria-pressed="false">6 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="7" aria-pressed="false">7 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="8" aria-pressed="false">8 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="9" aria-pressed="false">9 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="10" aria-pressed="false">10 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="11" aria-pressed="false">11 bulan</button>
																	<button type="button" class="tenor-btn" data-loan-tenor="12" aria-pressed="false">12 bulan</button>
															</div>
						</div>
					</div>
					<div class="request-field">
						<label for="loanReason" class="request-label">Alasan Pinjaman</label>
						<textarea id="loanReason" class="request-textarea" placeholder="Jelaskan alasan pengajuan pinjaman..." required></textarea>
					</div>
					<div class="request-field">
						<label class="request-label">Rincian Pinjaman</label>
						<div class="loan-detail-card" id="loanDetailCard" hidden>
							<div id="loanDetailContent" class="loan-detail-content" hidden>
								<div class="loan-detail-row">
									<span>Nominal pinjaman</span>
									<strong id="loanNominalValue">Rp 0</strong>
								</div>
								<div class="loan-detail-row">
									<span>Tenor</span>
									<strong id="loanTenorValue">0 bulan</strong>
								</div>
								<div class="loan-detail-row loan-detail-status">
									<span>Status</span>
									<strong id="loanStatusValue">-</strong>
								</div>
								<div class="loan-detail-row loan-detail-row-highlight">
									<span>Bunga <span class="loan-rate" id="loanRateValue">0,00% per bulan</span></span>
									<strong id="loanInterestValue">Rp 0</strong>
								</div>
								<div class="loan-detail-row">
									<span>Cicilan per bulan</span>
									<strong id="loanMonthlyInstallmentValue">Rp 0</strong>
								</div>
								<div class="loan-detail-divider"></div>
								<div class="loan-detail-row loan-detail-total">
									<span>Total cicilan</span>
									<strong id="loanTotalValue">Rp 0</strong>
								</div>
							</div>
						</div>
					</div>
					<button type="submit" id="submitLoanRequestButton" class="request-submit">Kirim Pengajuan Pinjaman</button>
				</form>
			</div>
		</section>
	</div>

	<div id="swapDayOffModal" class="request-modal" aria-hidden="true">
		<div class="modal-overlay" data-swap-close></div>
		<section class="request-panel" role="dialog" aria-modal="true" aria-labelledby="swapDayOffTitle">
			<div class="request-head">
				<h2 id="swapDayOffTitle" class="request-title">Form Pengajuan Tukar Hari Libur</h2>
				<button type="button" class="modal-close" id="closeSwapDayOffModal" aria-label="Tutup popup tukar hari libur">&times;</button>
			</div>
			<div class="request-body">
				<form id="swapDayOffRequestForm" class="request-form" method="post" action="https://absenpanha.com/home/submit_day_off_swap_request">
					<p class="request-kind">Jenis pengajuan: <strong>Tukar Hari Libur (1x)</strong></p>
					<div class="request-grid">
						<div class="request-field">
							<label for="swapWorkdayDate" class="request-label">Tanggal Libur Asli (jadi masuk)</label>
							<input id="swapWorkdayDate" class="request-input" type="date" name="swap_workday_date" required>
						</div>
						<div class="request-field">
							<label for="swapOffdayDate" class="request-label">Tanggal Libur Pengganti (jadi libur)</label>
							<input id="swapOffdayDate" class="request-input" type="date" name="swap_offday_date" required>
						</div>
					</div>
					<div class="request-field">
						<label for="swapNoteInput" class="request-label">Alasan/Catatan (Wajib)</label>
						<textarea id="swapNoteInput" class="request-textarea" name="swap_note" maxlength="200" placeholder="Contoh: acara keluarga" required></textarea>
					</div>
					<button type="submit" class="request-submit">Kirim Pengajuan Tukar Libur</button>
				</form>
			</div>
		</section>
	</div>

	<div id="toastMessage" class="toast" role="status" aria-live="polite"></div>

	<script>
		window.__USER_DASHBOARD_CONFIG = {"submitEndpoint":"\/home\/submit_attendance","leaveRequestEndpoint":"\/home\/submit_leave_request","loanRequestEndpoint":"\/home\/submit_loan_request","dashboardSummaryEndpoint":"\/home\/user_dashboard_live_data","loanConfig":{"minPrincipal":500000,"maxPrincipal":10000000,"minTenorMonths":1,"maxTenorMonths":12,"isFirstLoan":true},"shiftTimeText":"08:00 - 17:00","shiftKey":"pagi","attendanceBranch":"Baros","crossBranchEnabled":0,"officeLat":-6.217076,"officeLng":106.132128,"officeRadiusM":100,"maxAccuracyM":50,"officePoints":[{"label":"Kantor 1","lat":-6.217076,"lng":106.132128}],"officeFallbackPoints":[{"label":"Kantor 1","lat":-6.217076,"lng":106.132128},{"label":"Kantor 2","lat":-6.270039,"lng":106.120796}]};
		(function (cfg) {
			if (!cfg || typeof cfg !== 'object') {
				window.__USER_DASHBOARD_CONFIG = {};
				return;
			}
			var points = Array.isArray(cfg.officePoints) ? cfg.officePoints.slice() : [];
			var fallbackPoints = Array.isArray(cfg.officeFallbackPoints) ? cfg.officeFallbackPoints : [];
			var branch = String(cfg.attendanceBranch || '').toLowerCase();
			var crossBranchEnabled = Number(cfg.crossBranchEnabled) === 1 ? 1 : 0;
			var shouldIncludeFallback = crossBranchEnabled === 1;
			var defaultFallbackPoints = [
				{ label: 'Kantor 1', lat: -6.217076, lng: 106.132128 },
				{ label: 'Kantor 2', lat: -6.270039, lng: 106.120796 }
			];
			var normalized = [];
			var seen = {};
			var pushUnique = function (sourceList) {
				for (var i = 0; i < sourceList.length; i += 1) {
					var row = sourceList[i] && typeof sourceList[i] === 'object' ? sourceList[i] : {};
					var lat = Number(row.lat);
					var lng = Number(row.lng);
					if (!isFinite(lat) || !isFinite(lng)) {
						continue;
					}
					var key = lat.toFixed(6) + ',' + lng.toFixed(6);
					if (seen[key]) {
						continue;
					}
					seen[key] = true;
					normalized.push({
						label: String(row.label || 'Kantor'),
						lat: lat,
						lng: lng
					});
				}
			};
			pushUnique(points);
			if (shouldIncludeFallback) {
				pushUnique(fallbackPoints);
				if (normalized.length < 2) {
					pushUnique(defaultFallbackPoints);
				}
			}
			if (!normalized.length) {
				var primaryLat = Number(cfg.officeLat);
				var primaryLng = Number(cfg.officeLng);
				if (isFinite(primaryLat) && isFinite(primaryLng)) {
					normalized.push({
						label: 'Kantor',
						lat: primaryLat,
						lng: primaryLng
					});
				}
			}
			if (branch === 'cadasari' && normalized.length > 1 && shouldIncludeFallback) {
				normalized.sort(function (a, b) {
					var aIsKantor2 = String(a.label || '').toLowerCase().indexOf('kantor 2') !== -1;
					var bIsKantor2 = String(b.label || '').toLowerCase().indexOf('kantor 2') !== -1;
					if (aIsKantor2 === bIsKantor2) {
						return 0;
					}
					return aIsKantor2 ? -1 : 1;
				});
			}
			cfg.officePoints = normalized;
			window.__USER_DASHBOARD_CONFIG = cfg;
		})(window.__USER_DASHBOARD_CONFIG || {});
	</script>
	<script defer src="https://absenpanha.com/src/assets/js/home-user-dashboard.js?v=6d70477877e07c49424bb1a04dc48879"></script>
	<script>
	(function () {
		var tbody = document.getElementById('historyTableBody');
		if (!tbody) {
			return;
		}

		var rowCache = Object.create(null);
		var normalizeTimer = null;
		var isNormalizing = false;
		var observer = null;

		function text(value) {
			return String(value || '').replace(/\s+/g, ' ').trim();
		}

		function rowKeyFromCells(cells) {
			if (!cells || cells.length < 1) {
				return '';
			}
			return text(cells[0].textContent);
		}

		function rowKeyFromPayload(row) {
			var payload = row && typeof row === 'object' ? row : {};
			return text(payload.tanggal);
		}

		function ensureRowCells(row, count) {
			while (row.cells.length < count) {
				row.appendChild(document.createElement('td'));
			}
		}

		function isEmpty(v) {
			var t = text(v);
			return t === '' || t === '-';
		}

		function cacheValue(value) {
			return isEmpty(value) ? '' : text(value);
		}

		function scheduleNormalize(delayMs) {
			if (normalizeTimer !== null) {
				return;
			}
			var wait = typeof delayMs === 'number' && delayMs >= 0 ? delayMs : 40;
			normalizeTimer = window.setTimeout(function () {
				normalizeTimer = null;
				normalizeHistoryRowsInDom();
			}, wait);
		}

		function normalizeHistoryRowsInDom() {
			if (isNormalizing) {
				return;
			}
			isNormalizing = true;
			if (observer) {
				observer.disconnect();
			}

			var rows = tbody.querySelectorAll('tr');
			try {
				for (var i = 0; i < rows.length; i += 1) {
					var row = rows[i];
					if (row.cells.length === 1) {
						var colspanRaw = row.cells[0].getAttribute('colspan');
						var colspanVal = parseInt(colspanRaw || '1', 10);
						if (isFinite(colspanVal) && colspanVal > 1) {
							continue;
						}
					}
					ensureRowCells(row, 6);
					var cells = row.cells;
					var key = rowKeyFromCells(cells);
					if (key === '') {
						continue;
					}

					var cache = rowCache[key] || { catatan: '', potongan: '' };
					var catatanNow = text(cells[4].textContent);
					var potonganNow = text(cells[5].textContent);
					var catatanFixed = isEmpty(catatanNow) ? (cache.catatan !== '' ? cache.catatan : '-') : catatanNow;
					var potonganFixed = isEmpty(potonganNow) ? (cache.potongan !== '' ? cache.potongan : '-') : potonganNow;

					if (catatanNow !== catatanFixed) {
						cells[4].textContent = catatanFixed;
					}
					if (potonganNow !== potonganFixed) {
						cells[5].textContent = potonganFixed;
					}

					rowCache[key] = {
						catatan: cacheValue(catatanFixed) !== '' ? cacheValue(catatanFixed) : cache.catatan,
						potongan: cacheValue(potonganFixed) !== '' ? cacheValue(potonganFixed) : cache.potongan
					};
				}
			} finally {
				isNormalizing = false;
				if (observer) {
					observer.observe(tbody, { childList: true });
				}
			}
		}

		function normalizePayloadRows(rows) {
			if (!Array.isArray(rows)) {
				return rows;
			}
			for (var i = 0; i < rows.length; i += 1) {
				var payloadRow = rows[i] && typeof rows[i] === 'object' ? rows[i] : {};
				var key = rowKeyFromPayload(payloadRow);
				if (key === '') {
					continue;
				}
				var cache = rowCache[key] || { catatan: '', potongan: '' };
				var catatanRaw = text(payloadRow.catatan);
				var potonganRaw = text(payloadRow.potongan);
				var catatanFixed = isEmpty(catatanRaw) ? (cache.catatan !== '' ? cache.catatan : '-') : catatanRaw;
				var potonganFixed = isEmpty(potonganRaw) ? (cache.potongan !== '' ? cache.potongan : '-') : potonganRaw;

				payloadRow.catatan = catatanFixed;
				payloadRow.potongan = potonganFixed;
				rows[i] = payloadRow;

				rowCache[key] = {
					catatan: cacheValue(catatanFixed) !== '' ? cacheValue(catatanFixed) : cache.catatan,
					potongan: cacheValue(potonganFixed) !== '' ? cacheValue(potonganFixed) : cache.potongan
				};
			}
			scheduleNormalize(20);
			return rows;
		}

		function isLiveDataRequest(url) {
			var value = String(url || '').toLowerCase();
			if (value === '') {
				return false;
			}
			return value.indexOf('/home/user_dashboard_live_data') !== -1
				|| value.indexOf('/index.php/home/user_dashboard_live_data') !== -1
				|| value.indexOf('home/user_dashboard_live_data') === 0
				|| value.indexOf('index.php/home/user_dashboard_live_data') === 0
				|| value.indexOf('user_dashboard_live_data') !== -1;
		}

		function patchLiveDataFetch() {
			if (window.__USER_DASHBOARD_FETCH_PATCHED === true) {
				return;
			}
			if (typeof window.fetch !== 'function' || typeof window.Response !== 'function') {
				return;
			}
			var nativeFetch = window.fetch.bind(window);
			window.__USER_DASHBOARD_FETCH_PATCHED = true;
			window.fetch = function (input, init) {
				var requestUrl = '';
				if (typeof input === 'string') {
					requestUrl = input;
				}
				else if (input && typeof input.url === 'string') {
					requestUrl = input.url;
				}

				var result = nativeFetch(input, init);
				if (!isLiveDataRequest(requestUrl)) {
					return result;
				}

				return result.then(function (response) {
					if (!response || typeof response.clone !== 'function') {
						return response;
					}
					var contentType = '';
					if (response.headers && typeof response.headers.get === 'function') {
						contentType = String(response.headers.get('content-type') || '').toLowerCase();
					}
					if (contentType.indexOf('application/json') === -1) {
						return response;
					}

					return response.clone().json().then(function (payload) {
						if (!payload || payload.success !== true || !Array.isArray(payload.recent_logs)) {
							return response;
						}
						payload.recent_logs = normalizePayloadRows(payload.recent_logs);
						var headers = response.headers ? new Headers(response.headers) : new Headers();
						headers.set('Content-Type', 'application/json; charset=utf-8');
						return new Response(JSON.stringify(payload), {
							status: response.status,
							statusText: response.statusText,
							headers: headers
						});
					}).catch(function () {
						return response;
					});
				});
			};
		}

		observer = new MutationObserver(function () {
			scheduleNormalize(30);
		});
	observer.observe(tbody, { childList: true });
	scheduleNormalize(0);
	patchLiveDataFetch();
	}());
	</script>
	<script>
	(function () {
		var modal = document.getElementById('swapDayOffModal');
		if (!modal) {
			return;
		}
		var toast = document.getElementById('toastMessage');
		var openButtons = document.querySelectorAll('[data-swap-open]');
		var closeButton = document.getElementById('closeSwapDayOffModal');
		var overlayClose = modal.querySelector('[data-swap-close]');
		var firstField = document.getElementById('swapWorkdayDate');
		var form = document.getElementById('swapDayOffRequestForm');
		var submitButton = form ? form.querySelector('button[type="submit"]') : null;
		var submitLabel = submitButton ? String(submitButton.textContent || 'Kirim Pengajuan Tukar Libur') : 'Kirim Pengajuan Tukar Libur';
		var toastTimer = null;
		var initialSuccess = "";
		var initialError = "";

		function showToast(message) {
			if (!toast) {
				return;
			}
			toast.textContent = String(message || '');
			toast.classList.add('show');
			if (toastTimer !== null) {
				window.clearTimeout(toastTimer);
			}
			toastTimer = window.setTimeout(function () {
				toast.classList.remove('show');
			}, 7000);
		}

		function isOpen(elementId) {
			var el = document.getElementById(elementId);
			return !!(el && el.classList && el.classList.contains('show'));
		}

		function updateBodyOverflow() {
			var hasModalOpen = modal.classList.contains('show')
				|| isOpen('attendanceModal')
				|| isOpen('requestModal')
				|| isOpen('loanModal');
			document.body.style.overflow = hasModalOpen ? 'hidden' : '';
		}

		function openModal() {
			modal.classList.add('show');
			modal.setAttribute('aria-hidden', 'false');
			updateBodyOverflow();
			if (firstField) {
				window.setTimeout(function () {
					firstField.focus();
				}, 30);
			}
		}

		function closeModal() {
			modal.classList.remove('show');
			modal.setAttribute('aria-hidden', 'true');
			updateBodyOverflow();
		}

		for (var i = 0; i < openButtons.length; i += 1) {
			openButtons[i].addEventListener('click', function (event) {
				event.preventDefault();
				openModal();
			});
		}

		if (closeButton) {
			closeButton.addEventListener('click', closeModal);
		}
		if (overlayClose) {
			overlayClose.addEventListener('click', closeModal);
		}
		if (form) {
			form.addEventListener('submit', function (event) {
				if (typeof window.fetch !== 'function' || typeof window.FormData !== 'function') {
					closeModal();
					return;
				}
				event.preventDefault();

				var actionUrl = String(form.getAttribute('action') || '').trim();
				if (actionUrl === '') {
					showToast('Endpoint pengajuan tukar libur tidak ditemukan.');
					return;
				}

				var formData = new FormData(form);
				if (submitButton) {
					submitButton.disabled = true;
					submitButton.textContent = 'Mengirim...';
				}

				fetch(actionUrl, {
					method: 'POST',
					body: formData,
					headers: {
						'X-Requested-With': 'XMLHttpRequest'
					}
				}).then(function (response) {
					return response.json().catch(function () {
						return {
							success: false,
							message: 'Respons server tidak valid.'
						};
					}).then(function (payload) {
						if (!response.ok || !payload || payload.success !== true) {
							throw new Error(payload && payload.message ? payload.message : 'Pengajuan tukar hari libur gagal dikirim.');
						}
						return payload;
					});
				}).then(function (payload) {
					showToast(payload.message || 'Pengajuan tukar hari libur berhasil dikirim.');
					form.reset();
					closeModal();
				}).catch(function (error) {
					showToast(error && error.message ? error.message : 'Pengajuan tukar hari libur gagal dikirim.');
				}).finally(function () {
					if (submitButton) {
						submitButton.disabled = false;
						submitButton.textContent = submitLabel;
					}
				});
			});
		}

		document.addEventListener('keydown', function (event) {
			if (event.key === 'Escape' && modal.classList.contains('show')) {
				closeModal();
			}
		});

		if (initialSuccess) {
			showToast(initialSuccess);
		}
		else if (initialError) {
			showToast(initialError);
		}
	}());
	</script>
</body>
</html>
